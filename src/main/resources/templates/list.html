<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Artículos - Sistema de Inventarios</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</head>
<body>
<!-- Barra lateral -->
<div th:replace="~{fragments/sidebar :: sidebar}"></div>

<!-- Contenido principal -->
<div class="contenido">
    <h1><ion-icon name="cube-outline"></ion-icon> Lista de Artículos</h1>

    <!-- Mensajes de éxito/error -->
    <div th:if="${success}" class="mensaje-exito">
        <ion-icon name="checkmark-circle"></ion-icon>
        <span th:text="${success}"></span>
    </div>

    <div th:if="${error}" class="mensaje-error">
        <ion-icon name="alert-circle"></ion-icon>
        <span th:text="${error}"></span>
    </div>

    <!-- Tarjeta de contenido -->
    <div class="card">
        <h2><ion-icon name="filter-outline"></ion-icon> Filtros y Acciones</h2>

        <!-- Formulario de filtrado -->
        <form method="get" th:action="@{/articulos}" class="filtro-form">
            <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 20px;">
                <div style="flex: 1;">
                    <input type="text" name="filtro" th:value="${filtro}"
                           placeholder="Buscar por código o descripción..." class="form-control">
                </div>
                <button type="submit" class="btn-primary">
                    <ion-icon name="search-outline"></ion-icon> Buscar
                </button>
                <a th:href="@{/articulos}" class="btn-cancelar">
                    <ion-icon name="refresh-outline"></ion-icon> Limpiar
                </a>
            </div>
        </form>

        <!-- Tabla de artículos -->
        <div class="table-container">
            <table>
                <thead>
                <tr>
                    <th>Código</th>
                    <th>Descripción</th>
                    <th>Unidad</th>
                    <th>Precio</th>
                    <th>Inventario Inicial</th>
                    <th>Entradas</th>
                    <th>Salidas</th>
                    <th>Inventario Final</th>
                    <th>Estado</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="articulo : ${articulos}">
                    <td th:text="${articulo.codigo}"></td>
                    <td th:text="${articulo.descripcion}"></td>
                    <td th:text="${articulo.unidad}"></td>
                    <td class="table-number" th:text="${articulo.precio != null ? 'S/ ' + #numbers.formatDecimal(articulo.precio, 1, 'POINT', 2, 'COMMA') : 'S/ 0.00'}"></td>
                    <td class="table-number" th:text="${articulo.inventarioInicial}"></td>
                    <td class="table-number" th:text="${articulo.entradas}"></td>
                    <td class="table-number" th:text="${articulo.salidas}"></td>
                    <td class="table-number" th:text="${articulo.inventarioFinal}"></td>
                    <td>
                        <span th:if="${articulo.inventarioFinal == 0}" class="badge-salida">SIN STOCK</span>
                        <span th:if="${articulo.inventarioFinal > 0 && articulo.inventarioFinal <= 10}"
                              class="badge-salida" style="background: #fff3cd; color: #856404;">STOCK BAJO</span>
                        <span th:if="${articulo.inventarioFinal > 10}" class="badge-entrada">EN STOCK</span>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(articulos)}">
                    <td colspan="9" style="text-align: center; padding: 40px;">
                        <ion-icon name="alert-circle-outline" style="font-size: 48px; color: #6c757d;"></ion-icon>
                        <p style="margin-top: 10px;">No se encontraron artículos</p>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- Paginación -->
        <div th:if="${totalPaginas > 1}" class="paginacion">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 30px;">
                <div>
                    <span>Mostrando <span th:text="${articulos.size()}"></span> de <span th:text="${totalElementos}"></span> artículos</span>
                </div>

                <div style="display: flex; gap: 5px;">
                    <!-- Botón Primera -->
                    <a th:href="@{'/articulos'(page=0, size=${size}, filtro=${filtro})}"
                       th:classappend="${paginaActual == 0} ? 'disabled' : ''"
                       class="btn-paginacion">
                        <ion-icon name="chevron-back-outline"></ion-icon>
                    </a>

                    <!-- Botón Anterior -->
                    <a th:if="${paginaActual > 0}"
                       th:href="@{'/articulos'(page=${paginaActual-1}, size=${size}, filtro=${filtro})}"
                       class="btn-paginacion">
                        <ion-icon name="arrow-back-outline"></ion-icon>
                    </a>

                    <!-- Páginas -->
                    <span th:each="i : ${#numbers.sequence(0, totalPaginas-1)}"
                          th:if="${(i >= paginaActual-2 and i <= paginaActual+2) or i == 0 or i == totalPaginas-1}">
                            <a th:href="@{'/articulos'(page=${i}, size=${size}, filtro=${filtro})}"
                               th:text="${i+1}"
                               th:classappend="${i == paginaActual} ? 'active' : ''"
                               class="btn-paginacion">
                            </a>
                        </span>

                    <!-- Botón Siguiente -->
                    <a th:if="${paginaActual < totalPaginas-1}"
                       th:href="@{'/articulos'(page=${paginaActual+1}, size=${size}, filtro=${filtro})}"
                       class="btn-paginacion">
                        <ion-icon name="arrow-forward-outline"></ion-icon>
                    </a>

                    <!-- Botón Última -->
                    <a th:href="@{'/articulos'(page=${totalPaginas-1}, size=${size}, filtro=${filtro})}"
                       th:classappend="${paginaActual == totalPaginas-1} ? 'disabled' : ''"
                       class="btn-paginacion">
                        <ion-icon name="chevron-forward-outline"></ion-icon>
                    </a>
                </div>

                <div>
                    <select onchange="cambiarTamanio(this)" class="select-tamanio">
                        <option value="10" th:selected="${size == 10}">10 por página</option>
                        <option value="20" th:selected="${size == 20}">20 por página</option>
                        <option value="50" th:selected="${size == 50}">50 por página</option>
                        <option value="100" th:selected="${size == 100}">100 por página</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function cambiarTamanio(select) {
        const size = select.value;
        const url = new URL(window.location.href);
        url.searchParams.set('size', size);
        url.searchParams.set('page', 0); // Volver a primera página
        window.location.href = url.toString();
    }
</script>
</body>
</html>